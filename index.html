<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thailand Countdown Ultimate</title>
    <style>
        :root {
            --primary: #0d47a1;
            --secondary: #42a5f5;
            --accent: #ff9800;
            --success: #4caf50; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß */
        }

        body {
            margin: 0;
            font-family: sans-serif;
            background: linear-gradient(135deg, #0d47a1, #42a5f5);
            background-attachment: fixed;
            color: white;
            padding: 15px;
            text-align: center;
        }

        .card {
            background: white;
            color: #333;
            padding: 20px;
            border-radius: 20px;
            max-width: 600px;
            margin: auto;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .progress-container {
            width: 100%;
            background: #eee;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .bar {
            height: 15px;
            background: var(--success);
            width: 0%;
            transition: width .5s ease;
        }

        input, button { padding: 8px; margin: 5px; border-radius: 6px; border: 1px solid #ccc; }
        button { background: var(--primary); color: white; border: none; cursor: pointer; }

        /* Grid Layouts */
        .grid-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin: 10px 0;
        }

        .box {
            background: #f0f4f8;
            color: var(--primary);
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 13px;
            min-width: 120px;
            border: 1px solid #d1d9e6;
        }

        /* Flight Route */
        .flight-info {
            background: #e3f2fd;
            color: #0d47a1;
            padding: 15px;
            border-radius: 12px;
            font-weight: bold;
            margin: 15px 0;
            border-left: 5px solid var(--primary);
        }

        /* Calendar */
        #calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 10px;
        }

        .calendar-day {
            padding: 8px 0;
            border-radius: 6px;
            font-size: 12px;
            background: #fff; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏Å‡∏ï‡∏¥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
            border: 1px solid #eee;
        }

        .calendar-weekday { background: #bbdefb; font-weight: bold; padding: 5px 0; border-radius: 4px; }
        
        /* ‡∏™‡∏µ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ */
        .done { background: var(--success) !important; color: white; } /* ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß */
        .travel { background: var(--accent) !important; color: white; font-weight: bold; } /* ‡∏ß‡∏±‡∏ô‡∏ö‡∏¥‡∏ô */
        .today { border: 2px solid var(--primary); }
    </style>
</head>
<body>

<div class="card">
    <h2>üáπüá≠ ‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏ó‡∏¢ ‚úàÔ∏è</h2>

    <p>‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡∏ö‡∏¥‡∏ô‡∏Å‡∏•‡∏±‡∏ö:</p>
    <input type="datetime-local" id="endDateInput">
    <button onclick="saveSettings()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>

    <h3 id="countdownText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì...</h3>
    <div class="progress-container"><div class="bar" id="progressBar"></div></div>
    <div id="percentText" style="font-weight:bold; color:var(--success);">0%</div>

    <hr>
    <h3>üõ´ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</h3>
    <div class="flight-info" id="flightRoute"></div>

    <hr>
    <h3>üåç ‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏•‡∏Å</h3>
    <div class="grid-row" id="worldClock"></div>

    <hr>
    <h3>üå§ ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
    <div class="grid-row" id="weatherDisplay"></div>

    <hr>
    <h3>üìÜ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h3>
    <div id="monthLabel" style="font-weight:bold; color:var(--primary); margin-bottom:10px;"></div>
    <button onclick="changeMonth(-1)">‚óÄ</button>
    <button onclick="changeMonth(1)">‚ñ∂</button>
    <div id="calendar"></div>
</div>

<script>
/* ================= CONFIG ================= */
const WORK_START_DATE = new Date("2026-02-05T00:00:00");
const TRAVEL_DATE = new Date("2026-04-23T23:50:00");
const API_KEY = "10305e607cbb444690ceede20de29e6a";

let targetDate = new Date(localStorage.getItem("userEndDate") || "2026-04-23T23:50");

/* ================= INITIALIZE ================= */
function init() {
    document.getElementById("endDateInput").value = targetDate.toISOString().slice(0, 16);
    updateTick();
    setInterval(updateTick, 1000);
    renderWeather();
    renderCalendar();
}

function saveSettings() {
    const val = document.getElementById("endDateInput").value;
    if(val) {
        targetDate = new Date(val);
        localStorage.setItem("userEndDate", val);
        renderCalendar();
    }
}

/* ================= CORE LOGIC ================= */
function updateTick() {
    const now = new Date();
    const diff = targetDate - now;

    // Countdown Text
    if (diff <= 0) {
        document.getElementById("countdownText").innerHTML = "üéâ ‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß!";
    } else {
        const d = Math.floor(diff / 86400000);
        const h = Math.floor((diff % 86400000) / 3600000);
        const m = Math.floor((diff % 3600000) / 60000);
        const s = Math.floor((diff % 60000) / 1000);
        document.getElementById("countdownText").innerHTML = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å ${d} ‡∏ß‡∏±‡∏ô ${h} ‡∏ä‡∏°. ${m} ‡∏ô‡∏≤‡∏ó‡∏µ ${s} ‡∏ß‡∏¥`;
    }

    // Progress Bar (‡∏¢‡∏∂‡∏î‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ö‡∏¥‡∏ô)
    const totalDuration = targetDate - WORK_START_DATE;
    const elapsed = now - WORK_START_DATE;
    const percent = Math.min(Math.max((elapsed / totalDuration) * 100, 0), 100);
    document.getElementById("progressBar").style.width = percent + "%";
    document.getElementById("percentText").innerHTML = `‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ${percent.toFixed(2)}%`;

    // World Clock (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏á‡∏Ñ‡πÇ‡∏õ‡∏£‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡πÄ‡∏•‡πÄ‡∏ã‡∏µ‡∏¢)
    const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
    document.getElementById("worldClock").innerHTML = `
        <div class="box">üáπüá≠ ‡πÑ‡∏ó‡∏¢: ${now.toLocaleTimeString("th-TH", {timeZone:"Asia/Bangkok", ...timeOptions})}</div>
        <div class="box">üá≤üáæ ‡∏°‡∏≤‡πÄ‡∏•‡πÄ‡∏ã‡∏µ‡∏¢: ${now.toLocaleTimeString("th-TH", {timeZone:"Asia/Kuala_Lumpur", ...timeOptions})}</div>
        <div class="box">üá™üáπ ‡πÄ‡∏≠‡∏ò‡∏¥‡πÇ‡∏≠‡πÄ‡∏õ‡∏µ‡∏¢: ${now.toLocaleTimeString("th-TH", {timeZone:"Africa/Addis_Ababa", ...timeOptions})}</div>
    `;

    // Flight Info
    const flightTimeStr = targetDate.toLocaleString("th-TH", { 
        timeZone: "Africa/Addis_Ababa", 
        day: 'numeric', month: 'long', hour: '2-digit', minute: '2-digit' 
    });
    document.getElementById("flightRoute").innerHTML = `
        ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á: ADD ‚úà SIN ‚úà KUL ‚úà BKK<br>
        <span style="font-size:13px; font-weight:normal;">‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô (‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏≠‡∏ò‡∏¥‡πÇ‡∏≠‡πÄ‡∏õ‡∏µ‡∏¢): ${flightTimeStr} ‡∏ô.</span>
    `;
}

/* ================= WEATHER ================= */
async function renderWeather() {
    const cities = [{n:"Bangkok", c:"TH", f:"üáπüá≠"}, {n:"Hawassa", c:"ET", f:"üá™üáπ"}];
    try {
        const html = await Promise.all(cities.map(async city => {
            const r = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city.n},${city.c}&appid=${API_KEY}&units=metric`);
            const d = await r.json();
            return `<div class="box"><b>${city.f} ${city.n}</b><br>${Math.round(d.main.temp)}¬∞C | ${d.weather[0].main}</div>`;
        }));
        document.getElementById("weatherDisplay").innerHTML = html.join('');
    } catch(e) { document.getElementById("weatherDisplay").innerHTML = "‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"; }
}

/* ================= CALENDAR ================= */
let viewDate = new Date();
function renderCalendar() {
    const cal = document.getElementById("calendar");
    cal.innerHTML = "";
    const y = viewDate.getFullYear();
    const m = viewDate.getMonth();
    
    const monthNames = ["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô", "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"];
    document.getElementById("monthLabel").innerText = `${monthNames[m]} ${y + 543}`;

    ["‡∏≠‡∏≤", "‡∏à", "‡∏≠", "‡∏û", "‡∏û‡∏§", "‡∏®", "‡∏™"].forEach(d => cal.innerHTML += `<div class="calendar-weekday">${d}</div>`);

    const firstDay = new Date(y, m, 1).getDay();
    const lastDate = new Date(y, m + 1, 0).getDate();
    const today = new Date();
    today.setHours(0,0,0,0);

    for (let i = 0; i < firstDay; i++) cal.innerHTML += `<div></div>`;

    for (let d = 1; d <= lastDate; d++) {
        const currentLoopDate = new Date(y, m, d);
        let className = "calendar-day";

        // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç: ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏£‡∏¥‡πà‡∏° 5 ‡∏Å.‡∏û. ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô‡∏ô‡∏µ‡πâ")
        if (currentLoopDate >= WORK_START_DATE && currentLoopDate < today) {
            className += " done";
        }
        
        // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç: ‡∏ß‡∏±‡∏ô‡∏ö‡∏¥‡∏ô‡∏Å‡∏•‡∏±‡∏ö (23 ‡πÄ‡∏°.‡∏¢.)
        if (currentLoopDate.toDateString() === TRAVEL_DATE.toDateString()) {
            className += " travel";
        }

        // ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        if (currentLoopDate.toDateString() === today.toDateString()) {
            className += " today";
        }

        cal.innerHTML += `<div class="${className}">${d}</div>`;
    }
}

function changeMonth(step) {
    viewDate.setMonth(viewDate.getMonth() + step);
    renderCalendar();
}

init();
</script>
</body>
</html>
